<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>p5.js Compatibility - Keyboard Test</title>
    <!-- p5.js 2.x CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/2.0.1/p5.min.js"></script>
    <!-- Compatibility add-on -->
    <script src="data.js"></script>
    <style>
        body {
            font-family: monospace;
            margin: 20px;
            background: #1a1a2e;
            color: #e0e0e0;
        }

        h1 {
            color: #00d4ff;
        }

        #addLog {
            background: #16213e;
            padding: 16px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .pass {
            color: #0f0;
        }

        .fail {
            color: #f44;
        }

        .info {
            color: #ff0;
        }
    </style>
</head>

<body>
    <h1>Keyboard Compatibility Test</h1>

    <p>
        <strong>Your v1.x sketch</strong> — click the top canvas and press
        <kbd>←</kbd> / <kbd>→</kbd>. Background should turn grey / black.
    </p>
    <div id="sketch-status" style="margin-bottom:8px;font-size:13px;color:#aaa;">
        Hold ← for grey background &nbsp;|&nbsp; Hold → for black background &nbsp;|&nbsp; Release for default grey
        (220)
    </div>

    <!-- ① Your exact v1.x sketch -->
    <div id="v1-sketch"></div>

    <hr style="border-color:#333;margin:24px 0;">

    <p>
        <strong>Full compatibility tests</strong> — move circle with arrow keys,
        check the log for ✓/✗ results.
    </p>
    <div id="addLog"></div>

    <script>
        /* ── ① Your exact v1.x sketch (runs in its own instance) ── */
        new p5(function (p) {
            p.setup = function () {
                let cnv = p.createCanvas(400, 400);
                cnv.parent('v1-sketch');
            };

            p.draw = function () {
                p.background(220);               // default grey
                if (p.keyCode === RIGHT_ARROW) {
                    p.background(0);             // black  ← v1.x test
                } else if (p.keyCode === LEFT_ARROW) {
                    p.background(100);           // dark grey ← v1.x test
                }

                // small HUD so you can see what's happening
                p.fill(p.keyCode === RIGHT_ARROW ? 255 : p.keyCode === LEFT_ARROW ? 200 : 50);
                p.noStroke();
                p.textSize(13);
                p.textAlign(p.LEFT, p.TOP);
                p.text(`keyCode: ${p.keyCode}`, 8, 8);
                p.text(
                    p.keyCode === RIGHT_ARROW ? '→  RIGHT_ARROW ✓' :
                        p.keyCode === LEFT_ARROW ? '←  LEFT_ARROW ✓' : 'press ← or →',
                    8, 26
                );
            };
        });

        /* ── ② Full test suite ── */
        const addLogEl = document.getElementById('addLog');
        function addLog(msg, cls = 'info') {
            const line = document.createElement('div');
            line.className = cls;
            line.textContent = msg;
            addLogEl.prepend(line);
        }

        function testConstants() {
            const tests = [
                ['BACKSPACE', BACKSPACE, 8],
                ['DELETE', DELETE, 46],
                ['ENTER', ENTER, 13],
                ['RETURN', RETURN, 13],
                ['TAB', TAB, 9],
                ['ESCAPE', ESCAPE, 27],
                ['SHIFT', SHIFT, 16],
                ['CONTROL', CONTROL, 17],
                ['OPTION', OPTION, 18],
                ['ALT', ALT, 18],
                ['UP_ARROW', UP_ARROW, 38],
                ['DOWN_ARROW', DOWN_ARROW, 40],
                ['LEFT_ARROW', LEFT_ARROW, 37],
                ['RIGHT_ARROW', RIGHT_ARROW, 39],
            ];

            addLog('=== Constant Tests ===', 'info');
            let allPassed = true;
            for (const [name, actual, expected] of tests) {
                const passed = actual === expected;
                if (!passed) allPassed = false;
                addLog(
                    `${passed ? '✓' : '✗'} ${name} = ${actual} (expected ${expected})`,
                    passed ? 'pass' : 'fail'
                );
            }
            addLog(allPassed ? '✓ All constant tests passed!' : '✗ Some constant tests failed!', allPassed ? 'pass' : 'fail');
        }

        let x = 200;
        let y = 200;

        function setup() {
            createCanvas(400, 400);
            background(30);
            testConstants();
            addLog('Press arrow keys to move the circle. Check keyCode values below.', 'info');
        }

        function draw() {
            background(30, 30, 50);

            if (keyIsPressed) {
                if (keyIsDown(UP_ARROW)) y -= 2;
                if (keyIsDown(DOWN_ARROW)) y += 2;
                if (keyIsDown(LEFT_ARROW)) x -= 2;
                if (keyIsDown(RIGHT_ARROW)) x += 2;
            }

            x = constrain(x, 10, 390);
            y = constrain(y, 10, 390);

            fill(0, 212, 255);
            noStroke();
            circle(x, y, 20);

            fill(200);
            textSize(14);
            textAlign(LEFT, TOP);
            text(`keyCode: ${keyCode}`, 10, 10);
            text(`key: ${key}`, 10, 30);
        }

        function keyPressed() {
            addLog(`keyPressed → keyCode=${keyCode}, key="${key}", match=${keyCode === LEFT_ARROW ? 'LEFT' : keyCode === RIGHT_ARROW ? 'RIGHT' : keyCode === UP_ARROW ? 'UP' : keyCode === DOWN_ARROW ? 'DOWN' : 'other'}`);

            if (keyCode === LEFT_ARROW) addLog('✓ keyCode === LEFT_ARROW (37) works!', 'pass');
            if (keyCode === RIGHT_ARROW) addLog('✓ keyCode === RIGHT_ARROW (39) works!', 'pass');
            if (keyCode === UP_ARROW) addLog('✓ keyCode === UP_ARROW (38) works!', 'pass');
            if (keyCode === DOWN_ARROW) addLog('✓ keyCode === DOWN_ARROW (40) works!', 'pass');
            if (keyCode === ENTER) addLog('✓ keyCode === ENTER (13) works!', 'pass');
            if (keyCode === ESCAPE) addLog('✓ keyCode === ESCAPE (27) works!', 'pass');
            if (keyIsDown(37)) addLog('✓ keyIsDown(37) works!', 'pass');
        }

        function keyReleased() {
            addLog(`keyReleased → keyCode=${keyCode}, key="${key}"`);
        }
    </script>
</body>

</html>